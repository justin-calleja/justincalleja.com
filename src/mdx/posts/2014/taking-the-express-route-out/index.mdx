---
title: 'Taking the Express route out'
dateCreated: Dec 06, 2014 14:00:00 GMT+0000
tags: ['node', 'express']
tocEnabled: false
---

# Purpose

Example of how to separate route code in Express.js using `npm link`.

# Setting up

We can use the express generator to get up and running quickly with Express. Install it with `npm install express-generator -g` if you don't already have it:

```bash
tmp$ express todo-server
tmp$ cd todo-server
todo-server$ npm install
```

It might be worth mentioning that at the time of writing, this installs express at version approx 4.9.0 or _~4.9.0_.

At this point we could `npm start` to start our server. As defined in package.json, we're basically running `node ./bin/www`.

We now want to start working on a separate module which will contain the logic behind the _/items_ route in our application:

```bash
todo-server$ mkdir ../todo-items
todo-server$ cd ../todo-items
todo-items$ npm init
todo-items$ npm install --save express
```

# Writing some code

```bash
todo-items$ vim index.js
```

```javascript
var express = require('express');
var router = express.Router();

var items = require('./items.json');

router.get('/', function (req, res) {
  res.send(items);
});

module.exports = router;
```

```bash
todo-items$ vim items.json
```

```json
{
  "task A": true,
  "task B": false
}
```

We're just defining a GET on '/'. This means that, whichever route our _todo-items_ module gets loaded on in _todo-server_, making a GET request on it will give us back our items.json data.

That's great but _todo-server_ doesn't have _todo-items_ installed so how's it going to use it? We could publish _todo-items_ on npm or host it in a Git repo on Github for example.

As you can see, we're just experimenting with _todo-items_ for now. Maybe later we'll use a proper database. Maybe we're not sure which database to go with. Point is, we don't want to publish or host _todo-items_ as it's still early days, and besides, it would be better to avoid having to stay re-installing the module for every single change we make.

Enter `npm link`:

```bash
todo-items$ npm link
/Users/justin/.nvm/v0.10.33/lib/node_modules/todo-items -> /Users/justin/tmp/todo-items

todo-items$ cd ../todo-server
todo-server$ npm link todo-items
/Users/justin/tmp/todo-server/node_modules/todo-items -> /Users/justin/.nvm/v0.10.33/lib/node_modules/todo-items -> /Users/justin/tmp/todo-items
```

Executing it from _todo-items_ we get a link to this directory from our global node_modules. `npm link todo-items` in _todo-server_ gets us a link in _todo-server_'s node_modules to the link in our global node_modules, effectively linking back to our _todo-items_ directory containing our implementation for that module.

End result - if you list the contents of _todo-server_'s node_modules you'll see we have our _todo-items_ in there, albeit a link and not an actual directory structure as our other dependencies are installed as. Now, since the _todo-items_ installation in our _todo-server_ is just a link, any updates we make in _todo-items_ will automatically take effect in our _todo-server_ project.

# Seeing it work

Simply require and use:

```bash
todo-server$ vim app.js
```

```javascript
var items = require('todo-items');
app.use('/items', items);
```

Now we can `npm start`, hit http://localhost:3000/items in a browser, and get our items.json back.
